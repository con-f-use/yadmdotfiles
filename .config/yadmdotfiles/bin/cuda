#!/usr/bin/env bash

if ! command -v barracudavpn; then
  echo "Please install barracudavpn!" 1>&2
  exit 1
fi

cmds=$(mktemp)
trap 'rm -f "$cmds"' EXIT ERR

barracudavpn -p || truehttps://github.com/instantOS/instantASSIST/blob/master/assists/a.sh
user="${CUDAUSER:-jbischko}" 
pw="$(pass Cuda/cudaws || gopass show Cuda/cudaws)"
pw=${pw:-$(systemd-ask-password "password for $user")}
(
    sudo barracudavpn -s \
        -c "$HOME/.config/yadmdotfiles/cuda/barracudavpn/" \
        -l "$user" \
        -r "$pw" -v "$@" 2>&1 |
            tee "/dev/stdout" |
            sed -n 's/executing:/sudo ip/p' > "$cmds"
)
unset pw

sleep 5
cat "$cmds"

